---
title: "geoknife Tutorial"
author: "<b>USGS</b>: Jordan S Read"
date: "`r format(Sys.time(), '%d %B, %Y')`"
knit: (function(inputFile, encoding) { 
      out_dir <- 'test';
      rmarkdown::render(inputFile,
                        encoding=encoding, 
                        output_file='../geoknife.html') })
output:
  ioslides_presentation:
    css: ../styles.css
    logo: ../images/simple-shadow.png
    smaller: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Introduction

What is `geoknife`?
<p align="center">
  <img src="../images/geoknife.png" alt="geoknife" style="width: 300px;" align="center"/>
</p>

* R-package to get climate data into R

The `geoknife` package was created to support web-based geoprocessing of large gridded datasets according to their overlap with landscape (or aquatic/ocean) features that are often irregularly shaped. geoknife creates data access and subsequent geoprocessing requests for the USGS's Geo Data Portal to carry out on a web server. 

`geoknife`: 
 
* allows the user to avoid downloading large datasets
* avoids reinventing the wheel for the creation and optimization of complex geoprocessing algorithms
* uses computing resources that are dedicated elsewhere, so geoknife operations do not have much of an impact on a local computer

## Introduction

read more about `geoknife`:  
<p align="center">
  <a href="http://onlinelibrary.wiley.com/doi/10.1111/ecog.01880/full"><img src="../images/ecography_geoknife.png" alt="geoknife" align="center"/></a>
</p>
## Introduction

Where does the data come from?

* US Geological Survey
    + Climate and Land Use mission
* NASA
    + NLDAS, GLDAS, various
    + more being added....
* NOAA
    + NARR, many others
* Academia
    + E.g., PRISM

## Introduction
What does `geoknife` do to the data?

* `geoknife` subsets and/or summarizes data on a webserver, and let's you know when it is complete
![web workflow](images/web_workflow.png)

## Introduction
What does `geoknife` do to the data?

* `geoknife` subsets and/or summarizes data on a webserver, and let's you know when it is complete
<img src="images/summary_subset.png" width="100%" />


## Introduction
How to discover datasets?

* Using the `geoknife` `query()` function (examples to follow)
* Searching the [GDP catalog](http://cida.usgs.gov/gdp/)
* Websearches for OPeNDAP datasets (e.g., [apdrc website](http://apdrc.soest.hawaii.edu/data/data.php))
<img src="images/apdrc_data.png" width="100%" />


## Overview
geoknife concepts:
```{r, echo=T, eval=F}
geoknife(stencil, fabric, knife)
```
* `stencil`: the "feature" (lake, watershed, point, state, etc)  

<img src="images/geoknife_stencil.png" width="20%" />  

* `fabric`: the web available gridded data to be processed  

<img src="images/geoknife_fabric.png" width="20%" />  

* `knife`: processing configuration  

<img src="images/geoknife_knife.png" width="20%" />

## Stencil
A stencil can be defined in a number of different ways:  

* a numeric vector of lon, lat (`simplegeom` class)
```{r, echo=T, eval=F}
stencil = c(-89, 46)
```
* an R `data.frame()` (`simplegeom` class)
```{r, echo=T, eval=F}
stencil = data.frame('point1'=c(-89, 46), 'point2'=c(-88.6, 45.2))
```
* as a `sp::SpatialPolygons` class from a local shapefile
This is kind of a a hack right now, so I am not going to show it. But suggest it [here](https://github.com/USGS-R/geoknife/issues) if you want it.
* web available data (`webgeom` class) that are quickstart
```{r, echo=T, eval=F}
stencil = webgeom('state::New Hampshire,Wisconsin')
stencil = webgeom('ecoregion::Colorado Plateaus,Driftless Area')
```
* web available data (`webgeom` class) from a shapefile that you have uploaded
```{r, echo=T, eval=F}
stencil = webgeom(geom="upload:CIDA_TEST_", attribute = "Letter", value= "C")
```

## Stencil
Note the main difference between `simplegeom` and `webgeom` is their location/reference. 
* `simplegeom` is something that exists in your R environment
* `webgeom` is a web resource, using the Web Feature Service standard

In my workflows, I tend to use both: 
`simplegeoms` for point collections (lon, lat)
```{r, echo=T, eval=F}
stencil = data.frame('point1'=c(-89, 46), 'point2'=c(-88.6, 45.2))
```
`webgeoms` for getting data from an existing HUC, state, or uploading a bigger more complex file to be used again and again:
```{r, echo=T, eval=F}
stencil = webgeom('HUC8::09020306,14060009')
```
BTW, `webgeom('HUC8::09020306,14060009')` is equivalent to:
```{r, echo=T, eval=F}
stencil = webgeom(geom = 'derivative:wbdhu8_alb_simp',
                  attribute = 'HUC_8',
                  values = c('09020306', '14060009'))
```
`geoknife` has some "quickstart" references that simplify syntax for common stencils and fabric


